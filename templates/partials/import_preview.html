<div class="fixed inset-0 z-50 flex items-center justify-center">
    <div 
        class="absolute inset-0 bg-black bg-opacity-50"
        hx-get="/modal/close"
        hx-target="#modal-container"
        hx-swap="innerHTML"
    ></div>
    <div class="relative bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-4">
            <h3 class="font-bold text-lg">Import Preview</h3>
            <button
                hx-get="/modal/close"
                hx-target="#modal-container"
                hx-swap="innerHTML"
                class="text-gray-500 hover:text-gray-700"
            >
                ✕
            </button>
        </div>
        
        <div class="bg-green-50 border border-green-200 rounded p-3 mb-4">
            <p class="text-green-800 text-sm">
                <strong>{{ filename }}</strong> — Found {{ total_rows }} clients
                <span class="ml-2 px-2 py-0.5 bg-green-200 rounded text-xs">{{ mapping.confidence }} confidence</span>
            </p>
        </div>
        
        <div class="mb-4">
            <h4 class="font-semibold text-sm mb-2">Column Mapping</h4>
            <div class="grid grid-cols-2 gap-2 text-sm">
                <div class="flex justify-between bg-gray-50 px-2 py-1 rounded">
                    <span class="text-gray-500">Name:</span>
                    <span class="font-medium">{{ mapping.name or '—' }}</span>
                </div>
                <div class="flex justify-between bg-gray-50 px-2 py-1 rounded">
                    <span class="text-gray-500">Email:</span>
                    <span class="font-medium">{{ mapping.email or '—' }}</span>
                </div>
                <div class="flex justify-between bg-gray-50 px-2 py-1 rounded">
                    <span class="text-gray-500">Goal Weight:</span>
                    <span class="font-medium">{{ mapping.goal_weight or '—' }}</span>
                </div>
                <div class="flex justify-between bg-gray-50 px-2 py-1 rounded">
                    <span class="text-gray-500">Current Weight:</span>
                    <span class="font-medium">{{ mapping.weight or '—' }}</span>
                </div>
            </div>
            {% if mapping.unmapped_columns %}
            <p class="text-xs text-gray-500 mt-2">Unmapped columns: {{ mapping.unmapped_columns|join(', ') }}</p>
            {% endif %}
        </div>
        
        <div class="mb-4">
            <h4 class="font-semibold text-sm mb-2">Preview (first {{ preview|length }} rows)</h4>
            <div class="border rounded overflow-hidden">
                <table class="w-full text-sm">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-3 py-2 text-left">Name</th>
                            <th class="px-3 py-2 text-left">Email</th>
                            <th class="px-3 py-2 text-left">Goal</th>
                            <th class="px-3 py-2 text-left">Weight</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in preview %}
                        <tr class="border-t">
                            <td class="px-3 py-2">{{ row.name or '—' }}</td>
                            <td class="px-3 py-2">{{ row.email or '—' }}</td>
                            <td class="px-3 py-2">{{ row.goal_weight or '—' }}</td>
                            <td class="px-3 py-2">{{ row.weight or '—' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <form
            hx-post="/import/confirm"
            hx-target="#modal-container"
            hx-swap="innerHTML"
            class="flex gap-3"
        >
            <input type="hidden" name="tmp_path" value="{{ tmp_path }}">
            <input type="hidden" name="mapping" value='{{ mapping|tojson }}'>
            
            <button
                type="button"
                hx-get="/import"
                hx-target="#modal-container"
                hx-swap="innerHTML"
                class="flex-1 border px-4 py-2 rounded hover:bg-gray-50"
            >
                Back
            </button>
            <button
                type="submit"
                class="flex-1 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
            >
                Import {{ total_rows }} Clients
            </button>
        </form>
    </div>
</div>