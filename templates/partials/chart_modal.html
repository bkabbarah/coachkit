<div class="fixed inset-0 z-50 flex items-center justify-center">
    <div 
        class="absolute inset-0 bg-black bg-opacity-50"
        hx-get="/modal/close"
        hx-target="#modal-container"
        hx-swap="innerHTML"
    ></div>
    <div class="relative bg-white rounded-lg shadow-xl p-6 w-full max-w-3xl mx-4">
        <div class="flex justify-between items-center mb-4">
            <h3 class="font-bold text-lg">{{ client.name }} - Weight Progress</h3>
            <button
                hx-get="/modal/close"
                hx-target="#modal-container"
                hx-swap="innerHTML"
                class="text-gray-500 hover:text-gray-700"
            >
                âœ•
            </button>
        </div>
        
        <div class="h-80">
            <canvas id="expandedWeightChart"></canvas>
        </div>
        
        {% if client.goal_weight %}
        <div class="mt-4 flex gap-6 text-sm text-gray-600">
            <div>
                <span class="inline-block w-3 h-3 bg-blue-500 rounded mr-1"></span>
                Current Weight
            </div>
            <div>
                <span class="inline-block w-3 h-0.5 bg-green-500 mr-1" style="border-top: 2px dashed rgb(34, 197, 94);"></span>
                Goal: {{ client.goal_weight }} lbs
            </div>
        </div>
        {% endif %}
        
        <script>
            (function() {
                const ctx = document.getElementById('expandedWeightChart').getContext('2d');
                
                const data = [
                    {% for checkin in client.checkins|reverse %}
                        {% if checkin.weight %}
                        { x: '{{ checkin.created_at.strftime("%b %d, %Y") }}', y: {{ checkin.weight }} },
                        {% endif %}
                    {% endfor %}
                ];
                
                const goalWeight = {{ client.goal_weight or 'null' }};
                
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(d => d.x),
                        datasets: [
                            {
                                label: 'Weight (lbs)',
                                data: data.map(d => d.y),
                                borderColor: 'rgb(59, 130, 246)',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                fill: true,
                                tension: 0.3,
                                pointRadius: 4,
                                pointHoverRadius: 6
                            },
                            goalWeight ? {
                                label: 'Goal',
                                data: data.map(() => goalWeight),
                                borderColor: 'rgb(34, 197, 94)',
                                borderDash: [5, 5],
                                pointRadius: 0,
                                fill: false
                            } : null
                        ].filter(Boolean)
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.parsed.y + ' lbs';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: { 
                                beginAtZero: false,
                                title: { display: true, text: 'Weight (lbs)' }
                            },
                            x: {
                                title: { display: true, text: 'Date' }
                            }
                        }
                    }
                });
            })();
        </script>
    </div>
</div>